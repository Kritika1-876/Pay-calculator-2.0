<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Bi-Weekly Payroll Calculator ðŸ‡¯ðŸ‡²</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin:0;
  font-family: system-ui, -apple-system;
  background:#f2f4f7;
}
.container {
  max-width:960px;
  margin:auto;
  padding:16px;
}
.card {
  background:#fff;
  border-radius:12px;
  padding:16px;
  margin-bottom:16px;
  box-shadow:0 6px 14px rgba(0,0,0,.08);
}
h2,h3 { margin-top:0; }
table {
  width:100%;
  border-collapse:collapse;
  font-size:.9rem;
}
th,td {
  padding:6px;
  border-bottom:1px solid #ddd;
  text-align:center;
}
input,select,button {
  padding:6px;
  font-size:.9rem;
}
button { cursor:pointer; }
.history-item {
  padding:8px;
  border-bottom:1px solid #eee;
}
.small {
  font-size:.85rem;
  opacity:.7;
}
.holiday {
  background:#fff3cd;
}
</style>
</head>

<body>
<div class="container">

<div class="card">
<h2>Bi-Weekly Period</h2>
<label>Start Date:
<input type="date" id="startDate">
</label>
<button onclick="createPeriod()">Create Period</button>
<button onclick="nextPeriod()">âž• Next Bi-Weekly</button>
<p id="periodLabel"></p>
</div>

<div class="card">
<h3>Shift Log (All shifts = 12 hrs)</h3>
<table>
<thead>
<tr>
<th>Date</th>
<th>Worked</th>
<th>Shift</th>
<th>Hours</th>
<th>Location</th>
</tr>
</thead>
<tbody id="shiftTable"></tbody>
</table>
</div>

<div class="card">
<button onclick="calculatePayroll()">Calculate Payroll</button>
<div id="payrollResult"></div>
</div>

<div class="card">
<h3>History</h3>
<div id="history"></div>
</div>

</div>

<script>
// ================= CONFIG =================
const RATES = {
  regular: 400,
  overtime: 600,
  holiday: 800
};
const REGULAR_LIMIT = 80;
const SHIFT_HOURS = 12;

// ================= HOLIDAY ENGINE =================
function isHoliday(dateStr) {
  const d = new Date(dateStr);
  const m = d.getMonth() + 1;
  const day = d.getDate();

  // Fixed Jamaican holidays
  if (m === 1 && day === 1) return true;      // New Year's Day
  if (m === 8 && day === 6) return true;      // Independence Day
  if (m === 12 && day === 25) return true;    // Christmas
  if (m === 12 && day === 26) return true;    // Boxing Day

  return false;
}

// ================= STORAGE =================
let app = JSON.parse(localStorage.getItem("payrollApp")) || { periods: [] };
let currentPeriod = null;

// ================= PERIOD =================
function createPeriod(startOverride) {
  const start = startOverride || startDate.value;
  if (!start) return alert("Select start date");

  const s = new Date(start);
  const e = new Date(s);
  e.setDate(e.getDate() + 13);

  currentPeriod = {
    id: `${start}_to_${e.toISOString().slice(0,10)}`,
    start,
    end: e.toISOString().slice(0,10),
    shifts: []
  };

  for (let i = 0; i < 14; i++) {
    const d = new Date(s);
    d.setDate(d.getDate() + i);
    currentPeriod.shifts.push({
      date: d.toISOString().slice(0,10),
      worked:false,
      type:"day",
      hours:SHIFT_HOURS,
      location:""
    });
  }
  renderPeriod();
}

function nextPeriod() {
  if (!currentPeriod) return;
  const d = new Date(currentPeriod.end);
  d.setDate(d.getDate() + 1);
  createPeriod(d.toISOString().slice(0,10));
}

// ================= RENDER =================
function renderPeriod() {
  periodLabel.textContent = `${currentPeriod.start} â†’ ${currentPeriod.end}`;
  shiftTable.innerHTML = "";

  currentPeriod.shifts.forEach((s,i)=>{
    const holiday = isHoliday(s.date);
    shiftTable.innerHTML += `
      <tr class="${holiday?'holiday':''}">
        <td>${s.date}${holiday?' ðŸŽ‰':''}</td>
        <td><input type="checkbox" ${s.worked?'checked':''}
          onchange="toggleWorked(${i},this.checked)"></td>
        <td>
          <select onchange="changeShift(${i},this.value)">
            <option value="day" ${s.type==='day'?'selected':''}>Day</option>
            <option value="night" ${s.type==='night'?'selected':''}>Night</option>
          </select>
        </td>
        <td>${SHIFT_HOURS}</td>
        <td><input value="${s.location}"
          onchange="setLocation(${i},this.value)"></td>
      </tr>`;
  });
}

function toggleWorked(i,v){ currentPeriod.shifts[i].worked = v; }
function changeShift(i,v){
  currentPeriod.shifts[i].type = v;
}
function setLocation(i,v){ currentPeriod.shifts[i].location = v; }

// ================= PAYROLL =================
function calculatePayroll() {
  let totalHours = 0;
  let holidayHours = 0;

  currentPeriod.shifts.forEach(s=>{
    if(!s.worked) return;
    totalHours += SHIFT_HOURS;
    if(isHoliday(s.date)) holidayHours += SHIFT_HOURS;
  });

  const regularHours = Math.min(REGULAR_LIMIT, totalHours - holidayHours);
  const overtimeHours = Math.max(0, totalHours - holidayHours - REGULAR_LIMIT);

  const regularPay = regularHours * RATES.regular;
  const overtimePay = overtimeHours * RATES.overtime;
  const holidayPay = holidayHours * RATES.holiday;

  const gross = regularPay + overtimePay + holidayPay;

  const nis = gross * 0.03;
  const nht = gross * 0.02;
  const edu = gross * 0.0225;
  const taxable = gross - nis - nht - edu;
  const paye = taxable > 69206 ? (taxable - 69206) * 0.25 : 0;
  const net = gross - (nis + nht + edu + paye);

  currentPeriod.payroll = { gross, net };
  app.periods.push(currentPeriod);
  localStorage.setItem("payrollApp", JSON.stringify(app));
  renderHistory();

  payrollResult.innerHTML = `
    <h3>Pay Breakdown</h3>
    Regular: ${regularHours} hrs â†’ J$${regularPay.toFixed(2)}<br>
    Overtime: ${overtimeHours} hrs â†’ J$${overtimePay.toFixed(2)}<br>
    Holiday: ${holidayHours} hrs â†’ J$${holidayPay.toFixed(2)}<hr>
    <b>NET PAY:</b> J$${net.toFixed(2)}
  `;
}

// ================= HISTORY =================
function renderHistory() {
  history.innerHTML = "";
  app.periods.forEach(p=>{
    history.innerHTML += `
      <div class="history-item">
        ${p.start} â†’ ${p.end}<br>
        <span class="small">Net: J$${p.payroll.net.toFixed(2)}</span>
      </div>`;
  });
}
renderHistory();
</script>
</body>
</html>